<!DOCTYPE html>
<html>
<head>
    <title>Smart Healthcare AI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="ecg-container">
    <svg viewBox="0 0 1000 200" preserveAspectRatio="none">
        <path d="M0 100 
                 L100 100 L120 40 L140 160 L160 100 
                 L300 100 L320 60 L340 140 L360 100 
                 L500 100 L520 50 L540 150 L560 100 
                 L1000 100"
              class="ecg-line"/>
    </svg>
</div>

<div class="container">

<h1>Smart Healthcare AI</h1>
<p class="subtitle">Clinical Decision Support System</p>
<p class="disclaimer">
AI-generated prediction. This system assists medical evaluation and is not a substitute for professional diagnosis.
</p>

<form action="/predict" method="post" id="diagnosisForm">

<div class="grid">

<div>
<label>Age</label>
<input type="number" name="age" value="{{ form_data.age if form_data else '' }}" required>
</div>

<div>
<label>Sex</label>
<select name="sex" required>
<option value="1" {% if form_data and form_data.sex == "1" %}selected{% endif %}>Male</option>
<option value="0" {% if form_data and form_data.sex == "0" %}selected{% endif %}>Female</option>
</select>
</div>

<div>
<label>Chest Pain Type</label>
<select name="cp" required>
<option value="0" {% if form_data and form_data.cp == "0" %}selected{% endif %}>Typical Angina</option>
<option value="1" {% if form_data and form_data.cp == "1" %}selected{% endif %}>Atypical Angina</option>
<option value="2" {% if form_data and form_data.cp == "2" %}selected{% endif %}>Non-anginal Pain</option>
<option value="3" {% if form_data and form_data.cp == "3" %}selected{% endif %}>Asymptomatic</option>
</select>
</div>

<div>
<label>Resting Blood Pressure</label>
<input type="number" name="trestbps" value="{{ form_data.trestbps if form_data else '' }}" required>
</div>

<div>
<label>Cholesterol</label>
<input type="number" name="chol" value="{{ form_data.chol if form_data else '' }}" required>
</div>

<div>
<label>Fasting Blood Sugar</label>
<select name="fbs" required>
<option value="1" {% if form_data and form_data.fbs == "1" %}selected{% endif %}>Above 120 mg/dl</option>
<option value="0" {% if form_data and form_data.fbs == "0" %}selected{% endif %}>Normal</option>
</select>
</div>

<div>
<label>Resting ECG</label>
<select name="restecg" required>
<option value="0" {% if form_data and form_data.restecg == "0" %}selected{% endif %}>Normal</option>
<option value="1" {% if form_data and form_data.restecg == "1" %}selected{% endif %}>ST-T Abnormality</option>
<option value="2" {% if form_data and form_data.restecg == "2" %}selected{% endif %}>Left Ventricular Hypertrophy</option>
</select>
</div>

<div>
<label>Max Heart Rate</label>
<input type="number" name="thalach" value="{{ form_data.thalach if form_data else '' }}" required>
</div>

<div>
<label>Exercise Induced Angina</label>
<select name="exang" required>
<option value="1" {% if form_data and form_data.exang == "1" %}selected{% endif %}>Yes</option>
<option value="0" {% if form_data and form_data.exang == "0" %}selected{% endif %}>No</option>
</select>
</div>

<div>
<label>Oldpeak</label>
<input type="number" step="0.1" name="oldpeak" value="{{ form_data.oldpeak if form_data else '' }}" required>
</div>

<div>
<label>Slope</label>
<select name="slope" required>
<option value="0" {% if form_data and form_data.slope == "0" %}selected{% endif %}>Upsloping</option>
<option value="1" {% if form_data and form_data.slope == "1" %}selected{% endif %}>Flat</option>
<option value="2" {% if form_data and form_data.slope == "2" %}selected{% endif %}>Downsloping</option>
</select>
</div>

<div>
<label>Major Vessels (CA)</label>
<select name="ca" required>
<option value="0" {% if form_data and form_data.ca == "0" %}selected{% endif %}>0</option>
<option value="1" {% if form_data and form_data.ca == "1" %}selected{% endif %}>1</option>
<option value="2" {% if form_data and form_data.ca == "2" %}selected{% endif %}>2</option>
<option value="3" {% if form_data and form_data.ca == "3" %}selected{% endif %}>3</option>
</select>
</div>

<div>
<label>Thalassemia</label>
<select name="thal" required>
<option value="1" {% if form_data and form_data.thal == "1" %}selected{% endif %}>Normal</option>
<option value="2" {% if form_data and form_data.thal == "2" %}selected{% endif %}>Fixed Defect</option>
<option value="3" {% if form_data and form_data.thal == "3" %}selected{% endif %}>Reversible Defect</option>
</select>
</div>

</div>

<button type="submit" id="analyzeBtn">Run Diagnosis</button>
<div class="loader" id="loader"></div>

</form>

{% if prediction_text %}
<div class="dashboard">

<div class="card result-card">
<h2 class="{{ risk_class }}">Risk Category: {{ prediction_text }}</h2>
<h3>Predicted Risk: {{ risk }}%</h3>
<h4>Hybrid Model Accuracy: {{ accuracy }}%</h4>
<p class="summary">{{ summary }}</p>

<a href="/download_report?category={{ prediction_text }}&risk={{ risk }}">
<button type="button">Download Medical Report</button>
</a>
</div>

<div class="card chart-card">
<canvas id="riskPie"></canvas>
</div>

<div class="card bar-chart-card">
<canvas id="modelChart"></canvas>
</div>

</div>

<script>
new Chart(document.getElementById('riskPie'), {
type: 'pie',
data: {
labels: ['Disease Risk', 'Healthy Probability'],
datasets: [{
data: [{{ risk }}, {{ safe }}],
backgroundColor: ['#ef4444','#22c55e']
}]
}
});

var modelData = {{ model_scores | tojson | safe }};
new Chart(document.getElementById('modelChart'), {
type: 'bar',
data: {
labels: Object.keys(modelData),
datasets: [{
label: 'Accuracy',
data: Object.values(modelData)
}]
},
options: {
scales: {
y: { beginAtZero: true, max: 1 }
}
}
});
</script>
{% endif %}

<script>
document.getElementById("diagnosisForm").addEventListener("submit", function() {
document.getElementById("loader").style.display = "block";
document.getElementById("analyzeBtn").style.display = "none";
});
</script>

</div>
</body>
</html>
